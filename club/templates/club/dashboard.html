{% extends 'club/base.html' %}
{% load static %}

{% block title %}Mon Tableau de Bord - ASI Volley{% endblock %}

{% block content %}

<!-- En-tête du dashboard -->
<div class="bg-primary text-white py-4">
  <div class="container">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="mb-2">
          <i class="bi bi-speedometer2"></i>
          Tableau de Bord
        </h1>
        <p class="mb-0 lead">
          Bienvenue, <strong>{{ user.prenoms }} {{ user.nom }}</strong> !
        </p>
      </div>
      <div class="col-md-4 text-md-end mt-3 mt-md-0">
        <a href="{% url 'club:logout' %}" class="btn btn-light">
          <i class="bi bi-box-arrow-right"></i> Déconnexion
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Contenu principal -->
<div class="container my-5">
  
  <!-- Statistiques rapides -->
  <div class="row g-4 mb-5">
    
    <!-- Matchs joués -->
    <div class="col-md-3 col-6">
      <div class="card bg-primary text-white shadow h-100">
        <div class="card-body text-center p-4">
          <i class="bi bi-trophy-fill display-4 mb-3"></i>
          <h3 class="mb-1">{{ stats.matchs_joues|default:0 }}</h3>
          <p class="mb-0">Matchs joués</p>
        </div>
      </div>
    </div>
    
    <!-- Victoires -->
    <div class="col-md-3 col-6">
      <div class="card bg-success text-white shadow h-100">
        <div class="card-body text-center p-4">
          <i class="bi bi-check-circle-fill display-4 mb-3"></i>
          <h3 class="mb-1">{{ stats.victoires|default:0 }}</h3>
          <p class="mb-0">Victoires</p>
        </div>
      </div>
    </div>
    
    <!-- Défaites -->
    <div class="col-md-3 col-6">
      <div class="card bg-danger text-white shadow h-100">
        <div class="card-body text-center p-4">
          <i class="bi bi-x-circle-fill display-4 mb-3"></i>
          <h3 class="mb-1">{{ stats.defaites|default:0 }}</h3>
          <p class="mb-0">Défaites</p>
        </div>
      </div>
    </div>
    
    <!-- Pourcentage victoire -->
    <div class="col-md-3 col-6">
      <div class="card bg-warning text-dark shadow h-100">
        <div class="card-body text-center p-4">
          <i class="bi bi-percent display-4 mb-3"></i>
          <h3 class="mb-1">{{ stats.pourcentage|default:0 }}%</h3>
          <p class="mb-0">Taux de victoire</p>
        </div>
      </div>
    </div>
  </div>
  
  <div class="row g-4">
    
    <!-- Colonne gauche -->
    <div class="col-lg-8">
      
      <!-- Informations personnelles -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
          <h4 class="mb-0">
            <i class="bi bi-person-badge text-primary"></i>
            Mes Informations
          </h4>
        </div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <p class="mb-1 text-muted small">Nom complet</p>
              <p class="fw-bold mb-0">{{ user.nom }} {{ user.prenoms }}</p>
            </div>
            <div class="col-md-6">
              <p class="mb-1 text-muted small">Date de naissance</p>
              <p class="fw-bold mb-0">{{ user.date_naissance|date:"d/m/Y" }}</p>
            </div>
            <div class="col-md-6">
              <p class="mb-1 text-muted small">Email</p>
              <p class="fw-bold mb-0">{{ user.email }}</p>
            </div>
            <div class="col-md-6">
              <p class="mb-1 text-muted small">Téléphone</p>
              <p class="fw-bold mb-0">{{ user.telephone }}</p>
            </div>
            <div class="col-md-6">
              <p class="mb-1 text-muted small">Catégorie</p>
              <span class="badge bg-primary fs-6">{{ user.categorie.nom }}</span>
            </div>
            <div class="col-md-6">
              <p class="mb-1 text-muted small">Statut</p>
              <span class="badge {% if user.is_active %}bg-success{% else %}bg-secondary{% endif %} fs-6">
                {% if user.is_active %}Actif{% else %}Inactif{% endif %}
              </span>
            </div>
          </div>
          <div class="text-end mt-3">
            <a href="#" class="btn btn-outline-primary">
              <i class="bi bi-pencil"></i> Modifier
            </a>
          </div>
        </div>
      </div>
      
      <!-- Derniers matchs -->
      <div class="card shadow-sm">
        <div class="card-header bg-white">
          <h4 class="mb-0">
            <i class="bi bi-calendar-event text-primary"></i>
            Mes Derniers Matchs
          </h4>
        </div>
        <div class="card-body">
          {% if derniers_matchs %}
          <div class="list-group list-group-flush">
            {% for match in derniers_matchs %}
            <div class="list-group-item px-0">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h6 class="mb-1">{{ match.championnat.nom }}</h6>
                  <p class="mb-1 small text-muted">
                    vs {{ match.equipes_adverses.all|join:", " }}
                  </p>
                  <p class="mb-0 small text-muted">
                    <i class="bi bi-calendar"></i> {{ match.date_rencontre|date:"d/m/Y" }}
                  </p>
                </div>
                <div class="text-end">
                  <h4 class="mb-0">
                    <span class="text-primary">{{ match.sets_club }}</span>
                    -
                    <span class="text-secondary">{{ match.sets_adverse }}</span>
                  </h4>
                  <span class="badge {% if match.sets_club == 3 %}bg-success{% else %}bg-danger{% endif %}">
                    {{ match.resultat }}
                  </span>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <p class="text-center text-muted py-4 mb-0">
            <i class="bi bi-info-circle"></i>
            Aucun match enregistré
          </p>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Colonne droite -->
    <div class="col-lg-4">
      
      <!-- Prochains événements -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="bi bi-calendar-plus text-success"></i>
            Prochains Événements
          </h5>
        </div>
        <div class="card-body">
          {% if prochains_events %}
          <ul class="list-unstyled mb-0">
            {% for event in prochains_events %}
            <li class="mb-3 pb-3 border-bottom">
              <p class="mb-1 fw-bold">{{ event.titre }}</p>
              <p class="mb-0 small text-muted">
                <i class="bi bi-calendar"></i> {{ event.date|date:"d/m/Y à H:i" }}
              </p>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-center text-muted mb-0">
            Aucun événement prévu
          </p>
          {% endif %}
        </div>
      </div>
      
      <!-- Notifications -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="bi bi-bell text-warning"></i>
            Notifications
          </h5>
        </div>
        <div class="card-body">
          <div class="alert alert-info mb-2">
            <small>
              <i class="bi bi-info-circle"></i>
              Entraînement demain à 18h
            </small>
          </div>
          <div class="alert alert-warning mb-0">
            <small>
              <i class="bi bi-exclamation-triangle"></i>
              Paiement cotisation en attente
            </small>
          </div>
        </div>
      </div>
      
      <!-- Actions rapides -->
      <div class="card shadow-sm">
        <div class="card-header bg-white">
          <h5 class="mb-0">
            <i class="bi bi-lightning-fill text-danger"></i>
            Actions Rapides
          </h5>
        </div>
        <div class="card-body">
          <div class="d-grid gap-2">
            <a href="{% url 'club:calendar' %}" class="btn btn-outline-primary">
              <i class="bi bi-calendar"></i> Voir le calendrier
            </a>
            <a href="{% url 'club:contact' %}" class="btn btn-outline-success">
              <i class="bi bi-envelope"></i> Contacter le club
            </a>
            <a href="#" class="btn btn-outline-warning">
              <i class="bi bi-credit-card"></i> Payer ma cotisation
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}